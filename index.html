<!DOCTYPE html>
<html>
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


</head>
<body>
   <br>
   <div class="container">
      <div class="row">
            <h1>El Arqui Emma </h1>
            <p><strong>Datos del Presupuesto</strong></p>
            <div class="row">
               <div class="col-md-12">
            <input type="text" name="nombre_proyecto" id="proyecto" placeholder="Nombre del Proyecto" class="form-control">
            <br>
            <input type="text" name="cliente" id="cliente" placeholder="Nombre del Cliente" class="form-control">
            </div>
            </div>
            <hr>

            <table class="table table-bordered">
               <thead>
                  <th>Num</th>
                  <th>Concepto</th>
                  <th>Cantidad</th>
                  <th>Precio Unit</th>
                  <th>Subtotal</th>
               </thead>
               <tbody id="filas">

               </tbody>
            </table>

<hr>

            <fieldset id="contenido" class="form-inline">
            <div name="registro" id="registro[]" name="registro[]" class="form-inline">
               <label for="concepto" ><span>1.</span></label>
               <input hidden value="1" name="numero" id="numero">
               <input type="text" placeholder="Concepto" name="concepto[]" id="concepto" class="form-control">
               <input type="number" placeholder="Cantidad" name="cantidad[]" id="cantidad" value="1" onchange="calcular(this.parentElement)" class="form-control">
               <input type="number" placeholder="Precio Unitario" name="preciounit[]" id="preciounit" onchange="calcular(this.parentElement)" class="form-control">
               <input type="number" readonly name="subtotal[]" id="total" placeholder="Subtotal" class="form-control">
               <button onclick="agregar_fila(this.parentElement)" class="btn btn-primary">+ fila</button>
            </div>
            <br>
            </fieldset>
            <hr>
         <!--<button onclick="agregar_registro()">+</button>-->
         <button onclick="creaPDF()" class="btn btn-secondary" style="width: 25%; margin: auto;">Generar Presupuesto</button>
      </div>
   </div>
</body>



 <script src="dist/jspdf.min.js"></script>
 <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
 <script src='dist/jspdf.debug.js'></script>
 <script>
   
var proyecto= document.getElementById("proyecto");
var cliente= document.getElementById("cliente");
let contador=document.getElementById("numero").value;

var contenido= document.getElementById("contenido");
var filas= document.getElementById("filas");

var conceptos = [];
var cant = [];
var preciosu = [];
var subtotales = [];

var cosas=[];



function llenar_datos(){ 
   cant=[];
   var cantidad = document.getElementsByName("cantidad[]");
   //console.log(cantidad);

   for(var i=0;i<cantidad.length;i++){
      cant.push(cantidad[i].value)
   }

   console.log("Cantidades : "+cant);

}




 function creaPDF(){
   llenar_datos();
   var pdf = new jsPDF('p', 'pt', 'letter');
    //var doc = new jsPDF();
    pdf.setFontSize(22);
    
    pdf.text( proyecto.value,20,20);
    
    pdf.setFontSize(16);
    pdf.text(20, 30, cliente.value);
    
    
		var width = 600;
		document.body.style.width = width + "px";

		pdf.fromHTML(document.body, {
			callback: function (pdf) {
				var iframe = document.createElement('iframe');
				iframe.setAttribute('style', 'position:center;top:50;right:25;height:100%; width:800px');
				document.body.appendChild(iframe);
				iframe.src = pdf.output('datauristring');
				
			}
		});

   pdf.save(proyecto.value+'.pdf');
 }

 function agregar_registro(){


  
   contenido.innerHTML+='<div name="registro" id="registro[]" name="registro[]">\
   <label for="concepto" ><span>1.</span></label>\
   <input type="text" placeholder="Concepto" name="concepto[]" id="concepto">\
   <input type="number" placeholder="Cantidad" name="cantidad[]" id="cantidad" value="1" onchange="calcular(this.parentElement)">\
   <input type="number" placeholder="Precio Unitario" name="preciounit[]" id="preciounit" onchange="calcular(this.parentElement)">\
   <input type="number" readonly name="subtotal[]" id="total" placeholder="Subtotal" >\
</div>';
 }

 function agregar_fila(parent){
console.log(parent.childNodes)
filas.innerHTML+='<tr>\
   <td>'+contador+'</td>\
   <td>'+parent.childNodes[5].value+'</td>\
   <td>'+parent.childNodes[7].value+'</td>\
   <td>'+parent.childNodes[9].value+'</td>\
   <td>'+parent.childNodes[7].value *  parent.childNodes[9].value+'</td>\
   ';
}


 function calcular(parent){
 // var elem= parent.getElementById("numero");getElementsByTagName
 console.log(parent.childNodes);
   var subtotal= parent.childNodes[7].value *  parent.childNodes[9].value;
   parent.childNodes[11].value = subtotal;
   console.log(subtotal);
 }


 </script>

</html>
